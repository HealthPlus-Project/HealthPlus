<!DOCTYPE html>
<html lang="pt-br">
<head>
  <%- include('partials/head') %>
  <title>Meu Carrinho - HealthPlus</title>
</head>
<body>
  <%- include('partials/navbar') %>

  <main class="container py-4">
    <h2 class="text-success text-center mb-4">Meu Carrinho</h2>

    <% if (carrinho.length === 0) { %>
      <p class="text-muted text-center">Seu carrinho está vazio.</p>
      <div class="text-center mt-3">
        <a href="/" class="btn btn-success">Continuar comprando</a>
      </div>
    <% } else { %>
      <div class="row g-4">
        <% carrinho.forEach(item => { %>
          <div class="col-md-4 col-sm-6">
            <div class="card bg-light text-dark h-100 d-flex flex-column">
              <div class="card-img-container" style="height:180px; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                <img src="<%= item.imagem || '/img/remedio-placeholder.png' %>" alt="<%= item.nome %>" style="max-height:100%; max-width:100%; object-fit:contain;">
              </div>
              <div class="card-body d-flex flex-column">
                <h5 class="card-title"><%= item.nome %></h5>
                <p class="card-text text-muted">R$ <%= item.preco.toFixed(2) %></p>
                <p class="card-text">Quantidade: <%= item.quantidade %></p>

                <div class="mt-auto d-flex gap-2">
                  <button class="btn btn-success w-100" onclick="addToCart('<%= item.medicamentoId %>', '<%= item.nome %>', '<%= item.preco %>')">+</button>
                  <button class="btn btn-danger w-100" onclick="removeFromCart('<%= item.medicamentoId %>')">−</button>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      </div>

      <h4 class="text-end mt-4">Total: <strong class="text-success">R$ <%= total.toFixed(2) %></strong></h4>
      <div class="text-end mt-2 d-flex justify-content-end gap-2">
        <a href="/" class="btn btn-outline-secondary">Continuar comprando</a>
        <button class="btn btn-success">Finalizar compra</button>
      </div>
    <% } %>
  </main>

  <script>
    async function addToCart(id, nome, preco) {
      try {
        await fetch('/carrinho/adicionar', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ medicamentoId: id, nome, preco })
        });
        window.location.reload(); // recarrega pra atualizar quantidade e total
      } catch (err) { console.error(err); }
    }

    async function removeFromCart(id) {
      try {
        await fetch('/carrinho/remover', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ medicamentoId: id })
        });
        window.location.reload(); // recarrega pra atualizar quantidade e total
      } catch (err) { console.error(err); }
    }
  </script>

  <%- include('partials/footer') %>
</body>
</html>
