<!DOCTYPE html>
<html lang="pt-br">
<head>
  <%- include('partials/head') %>
  <title>Pagamento - HealthPlus</title>
</head>
<body>
  <%- include('partials/navbar') %>

  <main class="container py-4">
    <h2 class="text-success text-center mb-4">Pagamento</h2>

    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card shadow-sm border-0 rounded-4">
          <div class="card-body p-4">
            <h5 class="text-muted mb-3">Resumo do Pedido</h5>

            <ul class="list-group mb-3">
              <% carrinho.forEach(item => { %>
                <li class="list-group-item d-flex justify-content-between">
                  <span><%= item.nome %> (x<%= item.quantidade %>)</span>
                  <span>R$ <%= (item.preco * item.quantidade).toFixed(2) %></span>
                </li>
              <% }) %>
            </ul>

            <h5 class="text-end mb-4">
              Total: <strong class="text-success">R$ <%= total.toFixed(2) %></strong>
            </h5>

            <form action="/pagamento/processar" method="POST" id="paymentForm">
              <h5 class="mb-3">Escolha a forma de pagamento</h5>

              <div class="mb-3">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="metodo" id="cartao" value="cartao" checked>
                  <label class="form-check-label" for="cartao">Cartão de crédito</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="metodo" id="pix" value="pix">
                  <label class="form-check-label" for="pix">Pix</label>
                </div>
              </div>

              <div id="cartaoCampos">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">Número do cartão</label>
                    <input type="text" class="form-control" name="numero" maxlength="19" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Nome no cartão</label>
                    <input type="text" class="form-control" name="nomeCartao" required>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Validade</label>
                    <input type="text" class="form-control" name="validade" placeholder="MM/AA" required>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">CVV</label>
                    <input type="text" class="form-control" name="cvv" maxlength="3" required>
                  </div>
                </div>
              </div>

              <!-- QR Code -->
              <div id="pixCampos" class="text-center d-none">
                <p class="mt-3">Escaneie o QR Code abaixo para pagar via Pix:</p>
                <img src="/img/qrcode-pix-exemplo.png" alt="QR Code Pix" class="img-fluid mb-3" style="max-width:200px;">
              </div>

              <div class="text-end mt-4">
                <a href="/carrinho" class="btn btn-outline-secondary">Voltar</a>
                <button type="submit" class="btn btn-success">Confirmar Pagamento</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
    const cartaoRadio = document.getElementById('cartao');
    const pixRadio = document.getElementById('pix');
    const cartaoCampos = document.getElementById('cartaoCampos');
    const pixCampos = document.getElementById('pixCampos');

    const camposCartao = cartaoCampos.querySelectorAll("input");

    function atualizarCampos() {
      if (cartaoRadio.checked) {
        cartaoCampos.classList.remove('d-none');
        pixCampos.classList.add('d-none');
        camposCartao.forEach(campo => campo.required = true);
      } else if (pixRadio.checked) {
        cartaoCampos.classList.add('d-none');
        pixCampos.classList.remove('d-none');
        camposCartao.forEach(campo => campo.required = false);
      }
    }

    cartaoRadio.addEventListener('change', atualizarCampos);
    pixRadio.addEventListener('change', atualizarCampos);

    atualizarCampos();
  });
</script>

  <%- include('partials/footer') %>
</body>
</html>
